<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="读书笔记 —— Effective C++(3)" />
<meta property="og:locale" content="en" />
<meta name="description" content="这一节重点探讨构造函数、析构函数、以及赋值操作函数，他们与类的生命周期有关，其中有很多细节值得我们去思考。我们知道在类中如果没有显示声明构造函数、析构函数、copy构造函数、赋值重载函数，编译器则会自动生成这些函数。这些自动生成的函数在某些特殊情况下可能会出错。同时在某些特殊情况下，我们要拒绝自动生成这些函数（或者说让这些函数调用时失效）。当然自己显式定义这些函数是一个好的方法，但是有更方便的方法吗？当我们声明基类时，构造、析构函数往往要声明virtual。virtual析构函数有一些比较有意思的用法。最后当析构函数出现异常时，我们应该吞下或者直接中止，同时把异常的处理交给程序员而不是由析构函数抛出。最后，我们要注意不要在构造、析构函数内调用virtual函数，因为你调用的不是派生类的版本。" />
<meta property="og:description" content="这一节重点探讨构造函数、析构函数、以及赋值操作函数，他们与类的生命周期有关，其中有很多细节值得我们去思考。我们知道在类中如果没有显示声明构造函数、析构函数、copy构造函数、赋值重载函数，编译器则会自动生成这些函数。这些自动生成的函数在某些特殊情况下可能会出错。同时在某些特殊情况下，我们要拒绝自动生成这些函数（或者说让这些函数调用时失效）。当然自己显式定义这些函数是一个好的方法，但是有更方便的方法吗？当我们声明基类时，构造、析构函数往往要声明virtual。virtual析构函数有一些比较有意思的用法。最后当析构函数出现异常时，我们应该吞下或者直接中止，同时把异常的处理交给程序员而不是由析构函数抛出。最后，我们要注意不要在构造、析构函数内调用virtual函数，因为你调用的不是派生类的版本。" />
<link rel="canonical" href="https://fanventory.github.io/posts/Effective-C++_3/" />
<meta property="og:url" content="https://fanventory.github.io/posts/Effective-C++_3/" />
<meta property="og:site_name" content="Fanventory" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-12-08T19:43:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="读书笔记 —— Effective C++(3)" />
<meta name="twitter:site" content="@Fanventory" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-08T19:43:00+08:00","datePublished":"2022-12-08T19:43:00+08:00","description":"这一节重点探讨构造函数、析构函数、以及赋值操作函数，他们与类的生命周期有关，其中有很多细节值得我们去思考。我们知道在类中如果没有显示声明构造函数、析构函数、copy构造函数、赋值重载函数，编译器则会自动生成这些函数。这些自动生成的函数在某些特殊情况下可能会出错。同时在某些特殊情况下，我们要拒绝自动生成这些函数（或者说让这些函数调用时失效）。当然自己显式定义这些函数是一个好的方法，但是有更方便的方法吗？当我们声明基类时，构造、析构函数往往要声明virtual。virtual析构函数有一些比较有意思的用法。最后当析构函数出现异常时，我们应该吞下或者直接中止，同时把异常的处理交给程序员而不是由析构函数抛出。最后，我们要注意不要在构造、析构函数内调用virtual函数，因为你调用的不是派生类的版本。","headline":"读书笔记 —— Effective C++(3)","mainEntityOfPage":{"@type":"WebPage","@id":"https://fanventory.github.io/posts/Effective-C++_3/"},"url":"https://fanventory.github.io/posts/Effective-C++_3/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>读书笔记 —— Effective C++(3) | Fanventory
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Fanventory">
<meta name="application-name" content="Fanventory">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Fanventory</a>
    </div>
    <div class="site-subtitle font-italic">琼琼最聪明本人</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/Fanventory" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/Fanventory" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['zhangzhaofen','aliyun.com'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>读书笔记 —— Effective C++(3)</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->

<h1 data-toc-skip>读书笔记 —— Effective C++(3)</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1670499780"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Dec  8, 2022
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        
          <a href="https://github.com/fanventory">fanventory</a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="5628 words">
  <em>31 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <blockquote>
  <p>这一节重点探讨构造函数、析构函数、以及赋值操作函数，他们与类的生命周期有关，其中有很多细节值得我们去思考。我们知道在类中如果没有显示声明构造函数、析构函数、copy构造函数、赋值重载函数，编译器则会自动生成这些函数。这些自动生成的函数在某些特殊情况下可能会出错。同时在某些特殊情况下，我们要拒绝自动生成这些函数（或者说让这些函数调用时失效）。当然自己显式定义这些函数是一个好的方法，但是有更方便的方法吗？当我们声明基类时，构造、析构函数往往要声明virtual。virtual析构函数有一些比较有意思的用法。最后当析构函数出现异常时，我们应该吞下或者直接中止，同时把异常的处理交给程序员而不是由析构函数抛出。最后，我们要注意不要在构造、析构函数内调用virtual函数，因为你调用的不是派生类的版本。</p>
</blockquote>

<p><br />
<br /></p>

<h1 id="自动生成构造析构赋值函数">自动生成构造/析构/赋值函数</h1>
<p>C++中如果我们没有声明和定义构造函数、析构函数、copy构造函数、赋值重载函数，则编译器会为我们自动生成这些函数。<br />
例如我们实现一个空类：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">empty</span><span class="p">{</span> <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>经过编译器编译后，会自动生成构造函数、析构函数、copy构造函数、赋值重载函数，就像下面这样：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">empty</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">empty</span><span class="p">()</span> <span class="p">{}</span>
    <span class="n">empty</span><span class="p">(</span><span class="k">const</span> <span class="n">empty</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{...}</span>
    <span class="o">~</span><span class="n">empty</span><span class="p">()</span> <span class="p">{}</span>
    <span class="n">empty</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">empty</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{...}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这些知识相信大家都十分了解，我们接下来讨论一些细节：</p>
<ol>
  <li>如果我们自定义了构造/析构/赋值函数，那编译器就不会自动生成已有的那个函数。</li>
  <li>如果成员变量是引用或者const修饰，则编译器拒绝编译赋值动作。</li>
</ol>

<p>第1点相信大家再熟悉不过了。<br />
针对第2点，我们先来看下面一段代码：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Object</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Object</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="n">cosnt</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
<span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">T</span> <span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>考虑下面一段代码：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">newDog</span><span class="p">(</span><span class="s">"peter"</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">oldDog</span><span class="p">(</span><span class="s">"satch"</span><span class="p">);</span>
<span class="n">Object</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">P</span><span class="p">(</span><span class="n">newDog</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 一只叫peter的小狗，岁数为2</span>
<span class="n">Object</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">(</span><span class="n">oldDog</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 一只叫satch的小狗，岁数为1</span>

<span class="n">P</span><span class="o">=</span><span class="n">S</span><span class="p">;</span>    <span class="c1">//  现在p变量会发生什么呢？</span>
</pre></td></tr></tbody></table></code></div></div>

<p>我们假设赋值成功，对象P和S的成员变量name指向同一个引用，那修改P对象的name值也会影响S对象的name值。<br />
但这就不对了呀，S只是赋值给P，并不是P引用S。而且C++不允许，让声明的reference引用指向不同的对象。</p>

<p><br /></p>

<p>同样，对于const的成员变量，赋值操作会修改成员变量的值，更改const变量同样是不合法的。</p>

<p><br /></p>

<p>最后还有一种情况，如果某个基类将赋值操作函数定义为private，然后用派生类去继承它。编译器会拒绝自动生成一个赋值操作函数。这是因为当派生类的赋值操作需要调用基类的赋值操作函数，而基类的赋值操作是private，派生类并没有权限，所以编译器只能作罢。</p>

<blockquote>
  <p>以上三种情况，会导致编译器拒绝自动生成构造/析构/赋值函数。</p>
</blockquote>

<h2 id="总结"><span class="mr-2">总结</span><a href="#总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<blockquote>
  <ul>
    <li>编译器会在类缺省的情况下，自动生成构造/析构/赋值函数，但某些特殊情况例外</li>
  </ul>
</blockquote>

<h1 id="拒绝自动生成构造析构赋值函数">拒绝自动生成构造/析构/赋值函数</h1>
<p>我们假设一个场景，我们需要定义一个类来表示狗，但是按照现实逻辑，没有两条一模一样的狗，就好比如没有两个一模一样的人。按照这个逻辑，这个类并不能具备拷贝构造函数和赋值操作函数。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">newDog</span><span class="p">(</span><span class="s">"peter"</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">oldDog</span><span class="p">(</span><span class="s">"satch"</span><span class="p">);</span>
<span class="n">Object</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">P</span><span class="p">(</span><span class="n">newDog</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 一只叫peter的小狗，岁数为2</span>
<span class="n">Object</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">(</span><span class="n">oldDog</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 一只叫satch的小狗，岁数为1</span>

<span class="n">Object</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">R</span><span class="p">(</span><span class="n">P</span><span class="p">);</span> <span class="c1">// No，peter狗是唯一的</span>
<span class="n">P</span><span class="o">=</span><span class="n">S</span><span class="p">;</span>  <span class="c1">// No，peter和satch是两条不一样的狗</span>
</pre></td></tr></tbody></table></code></div></div>

<p>你可能会想，我们修改这两个函数的定义为空不就好了。但是这样做，编译可以通过，但在程序运行时会报错，这是我们不希望发生的，我们希望在编译阶段就发现错误，这是不能赋值的！<br />
为了解决这个问题，我们提出几种方法：</p>
<ol>
  <li>我们发现编译器产出的函数都是public，那意味着我们只要把拷贝构造函数和赋值操作函数声明为private，就可以在程序编译<code class="language-plaintext highlighter-rouge">P=S；</code>时报错。</li>
</ol>

<p>但是这个做法不是绝对安全的，因为member函数和friend函数也可以调用private函数。</p>

<ol>
  <li>针对这个点，我们发现只要声明函数而不去定义，那在编译器的连接阶段，<code class="language-plaintext highlighter-rouge">P=S；</code>这样的语句就会抛出连接错误。这样就可以解决member函数和friend函数调用问题。</li>
</ol>

<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Object</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Object</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="n">cosnt</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
<span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">T</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">Object</span><span class="p">(</span><span class="k">const</span> <span class="n">Object</span><span class="o">&amp;</span><span class="p">);</span> <span class="c1">// 这里参数名是可以省略的，因为我们并不需要使用它</span>
    <span class="n">Object</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Object</span><span class="o">&amp;</span><span class="p">);</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<ol>
  <li>我们注意到上面讲到有一种情况下也会阻止编译器自动生成函数，那就是基类定义了构造/析构/赋值函数，且类型为private的时候。基于这个思路，只要我们定义一个uncopyable类，然后继承它，就能解决问题了。<br />
代码逻辑如下：
    <div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">uncopyable</span><span class="p">{</span>
<span class="nl">protected:</span>
 <span class="n">uncopyable</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
 <span class="o">~</span><span class="n">uncopyable</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">uncopyable</span><span class="p">(</span><span class="k">const</span> <span class="n">uncopyable</span><span class="o">&amp;</span><span class="p">);</span>
 <span class="n">uncopyable</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">uncopyable</span><span class="o">&amp;</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">//  继承uncopyable类</span>
<span class="k">class</span> <span class="nc">Object</span><span class="o">:</span> <span class="k">private</span> <span class="n">uncopyable</span><span class="p">{</span>
 <span class="p">...</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<blockquote>
  <p>Boost也提供了类似的版本，名为noncopyable。</p>
</blockquote>

<h2 id="总结-1"><span class="mr-2">总结</span><a href="#总结-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<blockquote>
  <ul>
    <li>如果要阻止编译器生成构造/析构/赋值函数，可以采用声明为private类型，且不定义，或者继承uncopyable类的方法。</li>
  </ul>
</blockquote>

<h1 id="多态基类声明为virtual析构函数">多态基类声明为virtual析构函数</h1>
<p>我们知道C++中存在多态，可以让我们通过基类指针指向派生类，从而实现工厂模式。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">TimeKeeper</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">TimeKeeper</span><span class="p">();</span>
    <span class="o">~</span><span class="n">TimeKeeper</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">AtomicClock</span><span class="o">:</span> <span class="k">public</span> <span class="n">TimeKeeper</span> <span class="p">{...};</span> <span class="c1">//  原子钟</span>
<span class="k">class</span> <span class="nc">WaterClock</span><span class="o">:</span> <span class="k">public</span> <span class="n">TimeKeeper</span> <span class="p">{...};</span> <span class="c1">//  水钟</span>
<span class="k">class</span> <span class="nc">WristWatch</span><span class="o">:</span> <span class="k">public</span> <span class="n">TimeKeeper</span> <span class="p">{...};</span> <span class="c1">//  腕表</span>
<span class="c1">//  通过base class指针，指向derived class对象</span>
<span class="n">TimeKeeper</span> <span class="o">*</span><span class="n">ptk</span><span class="o">=</span><span class="n">getTimeKeeper</span><span class="p">();</span>    <span class="c1">//  动态分配对象，可以是原子钟、水钟或者腕表</span>
<span class="p">...</span> <span class="c1">//  运用钟</span>
<span class="k">delete</span> <span class="n">ptk</span><span class="p">;</span> <span class="c1">//  释放资源</span>
</pre></td></tr></tbody></table></code></div></div>

<p>但上面代码存在一个错误，基类没有声明virtual析构函数，导致我们执行<code class="language-plaintext highlighter-rouge">delete ptk;</code>时，base部分被释放了，但derived部分没有被销毁，从而造成资源泄漏。</p>

<p><br /></p>

<p>所以我们需要在base class中将析构函数声明为virtual。此时它会销毁整个对象，而不是base的局部部分。<br />
代码修改如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">virtual</span> <span class="o">~</span><span class="n">TimeKeeper</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="构造函数为什么不能是virtual函数"><span class="mr-2">构造函数为什么不能是virtual函数？</span><a href="#构造函数为什么不能是virtual函数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>因为virtual函数的执行依赖于virtual函数表，而virtual函数表的初始化是在构造函数中完成，所以构造函数无法声明为virtual函数。也就是说，构造函数中构造出virtual函数表，然后类中各个virtual成员函数根据virtual函数表执行。先有构造函数，再有virtual函数表。</p>

<h2 id="为什么默认的析构函数不是virtual函数"><span class="mr-2">为什么默认的析构函数不是virtual函数？</span><a href="#为什么默认的析构函数不是virtual函数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>回答这个问题前，首先思考一下，所有析构函数都需要声明为virtual吗？<br />
我们先看一个例子：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Point</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Point</span><span class="p">(</span><span class="kt">int</span> <span class="n">xCoord</span><span class="p">,</span><span class="kt">int</span> <span class="n">yCoord</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Point</span><span class="p">();</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这是一个二维空间坐标点类，它有两个成员变量（x和y），而一个int型变量占32bits，所以一个Point对象应该占64bits。在一些跨语言应用中，还可以当初64-bit量传递给其他语言，比如C语言。<br />
但是如果声明为virtual成员函数，则对象必须携带某些信息，用来执行运行期间该virtual函数调用哪一个版本。这些信息通常由vptr（virtual table pointer）指针指出。vptr指向一个函数指针数组，称为vtbl（virtual table）；每一个类都有一个对应的vtbl。当对象调用某一个virtual函数时，实际被调用的函数取决于该对象的vptr指针所指的vtbl。<br />
简单来说，如果Point class含有virtual函数，则它的存储空间不止64bits。因为一个指针也是32bits，所以为Point增加一个vptr会使存储空间中间50%~100%。<br />
造成的结果是，Point对象不能一次塞入64-bits的寄存器，也不能传递给其他语言（因为其他语言很可能没有vtpr结构）。<br />
所以，某些情况下不声明为virtual函数是不对的，而某些情况下无端端声明为virtual函数也是不对的。我们建议是，针对第一种情况，当class中至少存在一个virtual函数时，才为它声明virtual析构函数；针对第二种情况，如果该类不作为base class使用时，不应该声明为virtual函数。</p>

<p><br /></p>

<p>所以回到上面的问题，为什么默认的析构函数不是virtual函数？<br />
因为virtual函数指针和virtual函数表时需要消耗空间，而在类程序中又不一定被继承，所以默认的析构函数不是虚函数。</p>

<p><br /></p>

<blockquote>
  <p>类的空间存储：</p>
  <ul>
    <li>空的类是会占用类内存空间的，而且大小是1，原因是C++要求每个实例在内存中都有独一无二的地址。</li>
    <li>类的普通成员变量占用类内存空间，并且遵守字节对齐原则。</li>
    <li>类的static静态变量不占用类内存空间，原因是编译器将其放在全局变量区。</li>
    <li>类的普通成员函数不占用类内存空间。</li>
    <li>类的虚函数占用4个字节（32位系统）或8个字节（64位系统），用来指定虚函数的虚拟函数表的入口地址。一个类的虚函数指针是不变的，和虚函数的个数以及基类是否有虚函数没有关系的。</li>
    <li>C++编译系统中，数据和函数是分开存放的(函数放在代码区；数据主要放在栈区和堆区，少数放在静态/全局区以及文字常量区)，实例化不同对象时，只给数据分配空间，而函数不占用类内存空间（包括友元函数、内联函数）。</li>
  </ul>
</blockquote>

<h2 id="总结-2"><span class="mr-2">总结</span><a href="#总结-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<blockquote>
  <ul>
    <li>如果该类不作为base class使用时，不应该声明为virtual函数</li>
    <li>当class中至少存在一个virtual函数时，才为它声明virtual析构函数</li>
  </ul>
</blockquote>

<h1 id="纯虚析构函数">纯虚析构函数</h1>
<p>拥有纯虚（pure virtual）函数的类，为抽象类。抽象类不能实例化对象。抽象类的子类会自动继承该纯虚函数，如果子类中任然没有实现该方法，那么该子类任然为纯虚函数。<br />
声明代码如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">//声明格式：virtual 函数类型 函数名（ 参数列表 ） =0; 可以没有函数体的实现</span>
<span class="k">virtual</span> <span class="kt">int</span> <span class="n">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="kt">int</span> <span class="n">m</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>如果我们想将类声明为抽象类，但手上没有纯虚函数，此时我们可以将析构函数声明为纯虚函数。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">AWOV</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">AWOV</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span>
<span class="p">};</span>
<span class="n">AWOV</span><span class="o">::~</span><span class="n">AWOV</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>   <span class="c1">//  当然，你必须为纯虚析构函数提供一份定义</span>
</pre></td></tr></tbody></table></code></div></div>

<p>最外层的派生类会先调用析构函数，然后逐级调用析构函数，一直到里层的基类析构函数。编译器会在派生类的析构函数中创建一个对基类调用析构函数的动作。所以这里必须为纯虚析构函数提供一份定义，否则AWOV找不到对应的析构函数定义，连接器会报错。</p>

<h2 id="总结-3"><span class="mr-2">总结</span><a href="#总结-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<blockquote>
  <ul>
    <li>如果想将类声明为抽象类，但成员函数没有纯虚函数时，可以将析构函数声明为纯虚函数，但是需要为纯虚析构函数提供一份定义</li>
  </ul>
</blockquote>

<h1 id="析构函数异常">析构函数异常</h1>
<p>假设一个场景，我们有以下的类。</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="p">...</span>
    <span class="o">~</span><span class="n">Widget</span><span class="p">()</span> <span class="p">{...}</span> <span class="c1">//  假设可能会产生异常</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">doSomething</span><span class="p">(){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">}</span>   <span class="c1">//  程序运行到此处，v应该被自动销毁</span>
</pre></td></tr></tbody></table></code></div></div>

<p>我们现在执行<code class="language-plaintext highlighter-rouge">doSomething</code>函数，假设在执行过程中发生了异常，那系统要调用析构函数释放资源。<br />
但是这个时候，如果<code class="language-plaintext highlighter-rouge">Widget</code>析构函数也出现了异常。就会导致一个问题，前一个异常还没有处理完成，析构函数中的异常将怎么处理呢？<br />
对于C++而言，两个同时存在异常太多了，程序会不知道怎么处理它们。前一个异常的处理，需要析构函数释放资源；但是现在析构函数也异常了，如果抛出的话，上一层栈也是异常状态。那该怎么办呢？总的来说，它们会导致程序出现不明确的行为，或者导致程序过早结束。</p>

<h2 id="建议"><span class="mr-2">建议</span><a href="#建议" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>C++中，析构函数不要抛出异常，因为容易导致程序过早结束或出现不明确行为。</p>

<h2 id="现实例子"><span class="mr-2">现实例子</span><a href="#现实例子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>我们现在封装一个数据库操作类，由于打开数据库后，需要及时<code class="language-plaintext highlighter-rouge">close</code>掉数据库连接，否则会导致不必要的资源浪费（连接持续存在，但是我们已经不用了）。为了方便，我们可以将close方法写在数据库操作类的析构函数中。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">DBConn</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="p">...</span>
    <span class="o">~</span><span class="n">DBConn</span><span class="p">(){</span>
        <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">DBConnnection</span> <span class="n">db</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>客户使用该类的时候，代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span>   <span class="c1">//  在某个代码块内调用数据库</span>
    <span class="n">DBConn</span> <span class="n">dbc</span><span class="p">(</span><span class="n">DBConnnection</span><span class="p">.</span><span class="n">create</span><span class="p">());</span>
    <span class="p">...</span>
<span class="p">}</span>   <span class="c1">//  区块结束时，DBConn对象会自动调用析构函数，执行clase()方法</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="解决方法"><span class="mr-2">解决方法</span><a href="#解决方法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>根据上面数据库的例子，我们给出两个解决方法：</p>
<ol>
  <li>结束程序<br />
如果析构函数抛出异常，既然这个对象后面不会再使用了，那我们就结束掉程序（因为当前对象或变量正在注销，意味着它们不会在后面的代码出现，也就是不会对后面的行为产生影响），阻止异常从析构函数中传播出去，防止程序出现不明确行为。<br />
代码逻辑如下：
    <div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">DBConn</span><span class="o">::~</span><span class="n">DBConn</span><span class="p">{</span>
 <span class="k">try</span><span class="p">{</span>
     <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
 <span class="p">}</span><span class="k">catch</span> <span class="p">(...){</span>
     <span class="p">...</span> <span class="c1">//  记录错误情况</span>
     <span class="n">std</span><span class="o">::</span><span class="n">abort</span><span class="p">();</span>   <span class="c1">//  调用abort方法结束程序</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>吞下异常<br />
吞下异常是指记录下异常情况（必要的日志输出），然后忽略该异常，让异常不再向上传播。虽然一般而言吞下异常是个坏主意，但是比起程序过早结束和出现不明确行为，吞下异常让程序继续清理内存，防止内存泄漏。<br />
代码逻辑如下：
    <div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">DBConn</span><span class="o">::~</span><span class="n">DBConn</span><span class="p">{</span>
 <span class="k">try</span><span class="p">{</span>
     <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
 <span class="p">}</span><span class="k">catch</span> <span class="p">(...){</span>
     <span class="p">...</span> <span class="c1">//  记录错误情况</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>让客户处理<br />
以上两个方法都无法对异常做出反应，最好的方法还是让客户自己处理异常，而把上面两种方法作为第二重保险（如果处理不了该异常，则结束或者吞下它）。<br />
代码逻辑如下：</li>
</ol>

<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">DBConn</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="p">...</span>
    <span class="kt">void</span> <span class="n">close</span><span class="p">(){</span>   <span class="c1">//  自定义函数，处理各种可能的情况</span>
        <span class="c1">//  这里可以在数据库关闭前做各种检查，并执行对应措施，预防出现异常的情况出现</span>
        <span class="p">...</span>
        <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">DBConn</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">closed</span><span class="p">){</span>    <span class="c1">//  追踪关闭状态，防止客户忘记调用close方法</span>
            <span class="k">try</span><span class="p">{</span>
                <span class="n">db</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
            <span class="p">}</span><span class="k">catch</span> <span class="p">(...){</span>
                <span class="p">...</span> <span class="c1">//  记录错误情况</span>
                <span class="p">...</span> <span class="c1">//  结束或吞下异常</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">DBConnnection</span> <span class="n">db</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">closed</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="总结-4"><span class="mr-2">总结</span><a href="#总结-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<blockquote>
  <ul>
    <li>析构函数中不要抛出异常，因为可能导致程序过早结束或出现不明确行为</li>
    <li>提供一个普通函数（并非在析构函数中）对异常做出处理，而析构函数中出现异常应该直接结束程序或者吞下异常</li>
  </ul>
</blockquote>

<h1 id="不要在构造析构函数中调用virtual函数">不要在构造/析构函数中调用virtual函数</h1>
<p>我们先看一个例子，假设我们有有个股票交易类，该类表示每一笔交易，当交易创建的时候需要写入日志进行审计。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Transaction</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Transaction</span><span class="p">();</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">logTransaction</span><span class="p">()</span> <span class="n">cosnt</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="c1">//  日志记录</span>
<span class="p">};</span>
<span class="n">Transaction</span><span class="o">::</span><span class="n">Transaction</span><span class="p">(){</span>
    <span class="p">...</span>
    <span class="n">logTransaction</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>当然，交易类型可能有多种，对于不同的交易类型，需要记录的信息也有所差别。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="n">Class</span> <span class="n">BuyTransaction</span><span class="o">:</span> <span class="k">public</span> <span class="n">Transaction</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">logTransaction</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>    <span class="c1">//  买入交易记录</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="n">Class</span> <span class="n">SellTransaction</span><span class="o">:</span> <span class="k">public</span> <span class="n">Transaction</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">logTransaction</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>    <span class="c1">//  卖出交易记录</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>现在我们执行以下代码：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">BuyTransaction</span> <span class="n">b</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>我们很快发现了问题，Transaction构造函数在最后一行调用<code class="language-plaintext highlighter-rouge">logTransaction</code>方法，但这时候被调用的Transaciton的版本，而不是BuyTransaction的版本。本例中，由于logTransaction方法是纯虚函数，还会抛出连接器错误。也就是说，基类构造函数调用期间，virtual函数不是virtu函数，不会下降到derived class的阶层。<br />
我们有两个原因解释这个现象：</p>
<ol>
  <li>base class的构造函数先于derived class的构造函数调用。这个时候derived class很多成员变量尚未初始化，C++为了防止一些不安全的行为（如使用未初始化的变量），不能使用derived class的成员函数。</li>
  <li>在base class构造函数运行期间，所有的运行期类型信息（virtual函数，dynamic_cast，typeid等等）会被编译器解析为base class类型。也就是说，在derived class构造函数调用之前，并不是成为derived对象，而是视为base对象。</li>
</ol>

<p><br /></p>

<p>同样的道理也适用于析构函数，由于derived class的析构函数先于base class的析构函数调用。所以在base class析构函数调用时，derived class的成员变量是未定义值，C++视它们为不存在。base class析构函数后的对象成为一个base对象，C++的virtu函数部分也对应base class的定义。</p>

<h2 id="编译器能监测构造析构过程中是否调用virtual函数吗"><span class="mr-2">编译器能监测构造/析构过程中是否调用virtual函数吗？</span><a href="#编译器能监测构造析构过程中是否调用virtual函数吗" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>可能你有个疑问，那禁止在构造/析构函数中调用virtual函数不就好了吗？这对编译器很容易实现吧？<br />
回答这个问题之前，我们先来看下面一段代码：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Transaction</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Transaction</span><span class="p">();</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">logTransaction</span><span class="p">()</span> <span class="n">cosnt</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="c1">//  日志记录</span>
<span class="nl">private:</span>
    <span class="kt">void</span> <span class="n">init</span><span class="p">();</span>
<span class="p">};</span>
<span class="n">Transaction</span><span class="o">::</span><span class="n">Transaction</span><span class="p">(){</span>
    <span class="n">init</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Transaction</span><span class="o">::</span><span class="n">init</span><span class="p">(){</span>
    <span class="p">...</span>
    <span class="n">logTransaction</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>如果我们有多个构造函数，我们可能会提取重复部分（即init方法）。如果virtual函数存在于init方法中，而编译器检测构造函数并没有发现调用virtual函数，很有可能就让这段有问题的代码通过了。所以编译器监测构造/析构过程中是否调用virtual函数并不容易。</p>

<h2 id="解决方法-1"><span class="mr-2">解决方法</span><a href="#解决方法-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>这个场景下我们知道构造函数中肯定无法调用derived class的virtual函数了，所以解决方法就是将virtual函数转化为non-virtual函数。同时我们可以在derived class构造之前，通过初值列将必要的构造信息向上传递给base class的构造函数，从而实现不同类型的日志记录。<br />
代码逻辑如下：</p>
<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Transaction</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">Transaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">logInfo</span><span class="p">);</span>
    <span class="kt">void</span> <span class="n">logTransaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">logInfo</span><span class="p">);</span> <span class="c1">//  non-virtual函数</span>
    <span class="p">...</span>
<span class="p">};</span>
<span class="n">Transaction</span><span class="o">::</span><span class="n">Transaction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">logInfo</span><span class="p">){</span>
    <span class="p">...</span>
    <span class="n">logTransaction</span><span class="p">(</span><span class="n">logInfo</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">BuyTransaction</span><span class="o">:</span><span class="k">public</span> <span class="n">Transaction</span><span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">BuyTransaction</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">:</span><span class="n">Transaction</span><span class="p">(</span><span class="n">createLogString</span><span class="p">(</span><span class="n">params</span><span class="p">)){...}</span>
    <span class="p">...</span>
<span class="k">private</span><span class="o">:</span>
    <span class="c1">//  这里可以先将params参数操作后再传递给base class构造函数，增强灵活性和可读性</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">createLogString</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>注意，createLogString修饰为static，可以防止构造函数初始化过程中，该方法不会指向BuyTransaction对象内尚未初始化的成员变量。这很重要，因为base class构造和析构函数期间，这些成员变量处于未定义状态，不能下降传递给derived class。</p>

<h2 id="总结-5"><span class="mr-2">总结</span><a href="#总结-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<blockquote>
  <ul>
    <li>不要在构造/析构函数中调用virtual函数，因为这类调用不能下降到derived class层</li>
  </ul>
</blockquote>

<h1 id="reference">Reference</h1>
<p>[1] «Effective C++»<br />
[2] <a href="https://blog.csdn.net/qq_37200329/article/details/100066599">虚函数（virtual）</a><br />
[3] <a href="https://blog.csdn.net/luolaihua2018/article/details/110736211">C++中类所占的内存大小以及成员函数的存储位置</a></p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/reading-notes/'>Reading Notes</a>,
      <a href='/categories/effective-c/'>Effective C++</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/c/"
          class="post-tag no-text-decoration" >C++</a>
      
      <a href="/tags/reading-notes/"
          class="post-tag no-text-decoration" >Reading Notes</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0+%E2%80%94%E2%80%94+Effective+C%2B%2B%283%29+-+Fanventory&url=https%3A%2F%2Ffanventory.github.io%2Fposts%2FEffective-C%2B%2B_3%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0+%E2%80%94%E2%80%94+Effective+C%2B%2B%283%29+-+Fanventory&u=https%3A%2F%2Ffanventory.github.io%2Fposts%2FEffective-C%2B%2B_3%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=https%3A%2F%2Ffanventory.github.io%2Fposts%2FEffective-C%2B%2B_3%2F&text=%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0+%E2%80%94%E2%80%94+Effective+C%2B%2B%283%29+-+Fanventory" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/c/">C++</a>
    
      
      <a class="post-tag" href="/tags/leetcode/">leetcode</a>
    
      
      <a class="post-tag" href="/tags/reading-notes/">Reading Notes</a>
    
      
      <a class="post-tag" href="/tags/dynamic-programming/">Dynamic Programming</a>
    
      
      <a class="post-tag" href="/tags/template/">template</a>
    
      
      <a class="post-tag" href="/tags/pthread/">Pthread</a>
    
      
      <a class="post-tag" href="/tags/socket/">socket</a>
    
      
      <a class="post-tag" href="/tags/libevent/">Libevent</a>
    
      
      <a class="post-tag" href="/tags/multiprocess/">Multiprocess</a>
    
      
      <a class="post-tag" href="/tags/io%E5%A4%8D%E7%94%A8/">IO复用</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/Effective-C++_8/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1676364660"
    data-df="ll"
    >
  Feb 14, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>读书笔记 —— Effective C++(8)</h3>
            <div class="text-muted small">
              <p>
                





                
  上节我们讨论很多类设计过程的细节，这一节中，我们将尝试写一个swap函数。我们先写出它的普通版本。普通版本通过拷贝实现，某些情况下效率低下。所以我们决定用复制指针来代替拷贝整个对象，提出第二个特化版本。最后针对模板类型，我们提出自定义命名空间中专属版本。





经典版本
swap相信大家并不陌生，经典的swap函数写法如下所示：
1
2
3
4
5
6
7
8
9
namespac...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Effective-C++_9/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1677048900"
    data-df="ll"
    >
  Feb 22, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>读书笔记 —— Effective C++(9)</h3>
            <div class="text-muted small">
              <p>
                





                
  本节我们从类实现的角度来给出一些建议。在类的实现中，我们可以在变量使用之前的容易地方进行定义，但是不妥的定义位置可能会导致多余的运行成本，这个实现的小细节可能被很多人所忽略。此外，类实现时我们可能会用到一些转型，转型的表示方式有很多，但你会发现新式转型比旧式更加好用。转型不只是简单的换个解释方式，编译器会增加一些额外的语句转换变量。这导致了转型过程很容易出现错误，而且有一些转型特别费时...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Effective-C++_%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1678864560"
    data-df="ll"
    >
  Mar 15, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>读书笔记 —— Effective C++ (异常安全)</h3>
            <div class="text-muted small">
              <p>
                





                
  本节中我们探讨异常安全代码，首先我们通过一个例子指出这个例子中存在的异常不安全行为。在解决这些行为之前，我们先认识一下异常安全保证的等级。这很重要，因为我们需要根据选择的异常安全保证来解决例子中的问题。通常的解决方法有调换代码逻辑顺序，用智能指针管理对象。接着我们提出了一般化的异常安全代码设计策略，copy-and-swap。最后我们强调了并不是任何代码都可以改写成异常安全的，首先是异...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/Effective-C++_2/" class="btn btn-outline-primary"
    prompt="Older">
    <p>读书笔记 —— Effective C++(2)</p>
  </a>
  

  
  <a href="/posts/Effective-C++_4/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>读书笔记 —— Effective C++(4)</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/c/">C++</a>
    
      
      <a class="post-tag" href="/tags/leetcode/">leetcode</a>
    
      
      <a class="post-tag" href="/tags/reading-notes/">Reading Notes</a>
    
      
      <a class="post-tag" href="/tags/dynamic-programming/">Dynamic Programming</a>
    
      
      <a class="post-tag" href="/tags/template/">template</a>
    
      
      <a class="post-tag" href="/tags/pthread/">Pthread</a>
    
      
      <a class="post-tag" href="/tags/socket/">socket</a>
    
      
      <a class="post-tag" href="/tags/libevent/">Libevent</a>
    
      
      <a class="post-tag" href="/tags/multiprocess/">Multiprocess</a>
    
      
      <a class="post-tag" href="/tags/io%E5%A4%8D%E7%94%A8/">IO复用</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2023
          <a href="https://twitter.com/username">Fanventory</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">

          

          

          Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
           with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
           theme.
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

